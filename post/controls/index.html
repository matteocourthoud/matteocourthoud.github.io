<!DOCTYPE html><html lang="en-us" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.1.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  

  
  
  
    
  
  <meta name="description" content="When analyzing causal relationships, it is very hard to understand which variables to condition the analysis on, i.e. how to &ldquo;split&rdquo; the data so that we are comparing apples to apples." />

  
  <link rel="alternate" hreflang="en-us" href="https://matteocourthoud.github.io/post/controls/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#003f5c" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Source+Sans+Pro:wght@200;300;400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Source+Sans+Pro:wght@200;300;400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.4f7182ca394d705ee32d9d7750e9aa1d.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144780600-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-144780600-1', { 'anonymize_ip': true });
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu03e9b3967b83fd39296ec9da5ff1ea05_201175_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu03e9b3967b83fd39296ec9da5ff1ea05_201175_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://matteocourthoud.github.io/post/controls/" />

  
  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image" />
  
  <meta property="og:site_name" content="Matteo Courthoud" />
  <meta property="og:url" content="https://matteocourthoud.github.io/post/controls/" />
  <meta property="og:title" content="DAGs and Control Variables | Matteo Courthoud" />
  <meta property="og:description" content="When analyzing causal relationships, it is very hard to understand which variables to condition the analysis on, i.e. how to &ldquo;split&rdquo; the data so that we are comparing apples to apples." /><meta property="og:image" content="https://matteocourthoud.github.io/post/controls/featured.png" />
    <meta property="twitter:image" content="https://matteocourthoud.github.io/post/controls/featured.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2022-04-25T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2022-04-25T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://matteocourthoud.github.io/post/controls/"
  },
  "headline": "DAGs and Control Variables",
  
  "image": [
    "https://matteocourthoud.github.io/post/controls/featured.png"
  ],
  
  "datePublished": "2022-04-25T00:00:00Z",
  "dateModified": "2022-04-25T00:00:00Z",
  
  "publisher": {
    "@type": "Organization",
    "name": "Matteo Courthoud",
    "logo": {
      "@type": "ImageObject",
      "url": "https://matteocourthoud.github.io/media/icon_hu03e9b3967b83fd39296ec9da5ff1ea05_201175_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "When analyzing causal relationships, it is very hard to understand which variables to condition the analysis on, i.e. how to \u0026ldquo;split\u0026rdquo; the data so that we are comparing apples to apples."
}
</script>

  

  

  
  
  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js" integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css" integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#003f5c",
          "text": "rgb(255, 255, 255)"
        },
        "button": {
          "background": "rgb(255, 255, 255)",
          "text": "#003f5c"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "/privacy/"
      }
    })});
  </script>


  





  <title>DAGs and Control Variables | Matteo Courthoud</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="fd5f8adabb41c0c3eff505f3e4584cfc" >

  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.66d3e0fff6d32c4ece05adee927fbd96.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Matteo Courthoud</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Matteo Courthoud</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Research</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Courses</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/course/ml-econ/"><span>Machine Learning for Economics</span></a>
            
              <a class="dropdown-item" href="/course/data-science/"><span>Data Science with Python</span></a>
            
              <a class="dropdown-item" href="/course/empirical-io/"><span>PhD Industrial Organization</span></a>
            
              <a class="dropdown-item" href="/course/metrics/"><span>PhD Econometrics</span></a>
            
              <a class="dropdown-item" href="https://pp4rs.github.io/"><span>Programming Practices for Research</span></a>
            
          </div>
        </li>

        
        

        

        
        
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/cv"><span>CV</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    <div class="container-fluid docs">
  <div class="row">

    <div class="col-xl-2 col-lg-2 d-none d-xl-block d-lg-block empty">
    </div>

    <div class="col-2 col-xl-2 col-lg-2 d-none d-lg-block docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#directed-acyclic-graphs">Directed Acyclic Graphs</a>
      <ul>
        <li><a href="#definitions">Definitions</a></li>
        <li><a href="#causality">Causality</a></li>
      </ul>
    </li>
    <li><a href="#example-class-size-and-math-scores">Example: Class Size and Math Scores</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
    </div>

    <main class="col-xl-8 col-lg-8 docs-content" role="main">
        <article class="article">
        




















  


<div class="article-container pt-3">
  <h1>DAGs and Control Variables</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Apr 25, 2022
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  
  
  
  

  
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 1540px; max-height: 874px;">
  <div style="position: relative">
    <img src="/post/controls/featured.png" alt="" class="featured-image">
    
  </div>
</div>


        <div class="article-container">
          <div class="article-style" align="justify">
            <p>When analyzing causal relationships, it is very hard to understand which variables to <strong>condition the analysis on</strong>, i.e. how to &ldquo;split&rdquo; the data so that we are <strong>comparing apples to apples</strong>. For example, if you want to understand the effect of having a tablet in class on studenta&rsquo; performance, it makes sense to compare schools where students have similar socio-economic backgrounds. Otherwise, the risk is that only wealthier students can afford a tablet and, without controlling for it, we might attribute the effect to tablets instead of the socio-economic background.</p>
<p>When the treatment of interest comes from a proper <strong>randomized experiment</strong>, we do not need to worry about conditioning on other variables. If tablets are distributed randomly across schools, and we have enough schools in the experiment, we do not have to worry about the socio-economic background of students. The only advantage of conditioning the analysis on some so-called &ldquo;control variable&rdquo; could be an increase in power. However, this is a different story.</p>
<p>In this post, we are going to have a brief introduction to Directed Acyclic Graphs and how they can be useful to select variables to condition a causal analysis on. Not only DAGs provide visual intuition on which variables we need to <em>include</em> in the analysis, but also on which variables we should <em>not include</em>, and why.</p>
<h2 id="directed-acyclic-graphs">Directed Acyclic Graphs</h2>
<h3 id="definitions">Definitions</h3>
<p><strong>Directed acyclic graphs</strong> (<strong>DAG</strong>s) provide a visual representation of the data generating process. Random variables are represented with letters (e.g. $X$) and causal relationships are represented with arrows (e.g. $\to$). For example, we interpret</p>
<pre><code class="language-mermaid">flowchart LR
classDef white fill:#FFFFFF,stroke:#000000,stroke-width:2px
X((X)):::white --&gt; Y((Y)):::white
</code></pre>
<p>as $X$ (possibly) causes $Y$. We call a <strong>path</strong> between two variables $X$ and $Y$ any connection, <em>independently of the direction of the arrows</em>. If all arrows point forward, we call it a <strong>causal path</strong>, otherwise we call it a <strong>spurious path</strong>.</p>
<pre><code class="language-mermaid">flowchart LR
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;

X((X))
Y((Y))
Z1((Z1))
Z2((Z2))
Z3((Z3))

X --&gt; Z1
Z1 --&gt; Z2
Z3 --&gt; Z2
Z3 --&gt; Y

class X,Y included;
class Z1,Z2,Z3 excluded;
</code></pre>
<p>In the example above, we have a path between $X$ and $Y$ passing through the variables $Z_1$, $Z_2$, and $Z_3$. Since not all arrows point forward, the path is <em>spurious</em> and there is no causal relationship of $X$ on $Y$. In fact, variable $Z_2$ is caused by both $Z_1$ and $Z_3$ and therefore <strong>blocks</strong> the path.</p>
<p>$Z_2$ is called a <strong>collider</strong>.</p>
<p>The purpose of our analysis is to assess the <strong>causal relationship</strong> between two variables $X$ and $Y$. Directed acyclic graphs are useful because they provide us instructions on which other variables $Z$ we need to <strong>condition</strong> our analysis on. Conditioning the analysis on a variable means that we keep it fixed and we draw our conclusions <em>ceteris paribus</em>. For example, in a linear regression framework, inserting another regressor $Z$ means that we are computing the best linear approximation of the conditional expectation function of $Y$ given $X$, <em>conditional</em> on the observed values of $Z$.</p>
<h3 id="causality">Causality</h3>
<p>In order to assess causality, we want to <strong>close all spurious paths</strong> between $X$ and $Y$. The <strong>questions</strong> now are:</p>
<ul>
<li>When is a path <strong>open</strong>?
<ul>
<li>If it does not contain <em>colliders</em>. Otherwise, it is <em>closed</em>.</li>
</ul>
</li>
<li>How do you <strong>close an open path</strong>?
<ul>
<li>You condition on <em>at least one</em> intermediate variable.</li>
</ul>
</li>
<li>How do you <strong>open a closed path</strong>?
<ul>
<li>You condition on <em>all</em> colliders along the path.</li>
</ul>
</li>
</ul>
<p>Suppose we are again interested in the causal relationship of $X$ on $Y$. Let&rsquo;s consider the following graph</p>
<pre><code class="language-mermaid">flowchart LR
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;

X((X))
Y((Y))
Z1((Z1))
Z2((Z2))
Z3((Z3))

X --&gt; Y
X --&gt; Z2
Z2 --&gt; Y
Z1 --&gt; X
Z1 --&gt; Y
X --&gt; Z3
Y --&gt; Z3

class X,Y included;
class Z1,Z2,Z3 excluded;
</code></pre>
<p>In this case, apart from the direct path, there are <strong>three non-direct paths</strong> between $X$ and $Y$ through the variables $Z_1$, $Z_2$, and $Z_3$.</p>
<p>Let&rsquo;s consider the case in which we analyze the relationship between $X$ and $Y$, ignoring all other variables.</p>
<ol>
<li>The path through $Z_1$ is <strong>open</strong> but it is <strong>spurious</strong></li>
<li>The path through $Z_2$ is <strong>open</strong> and <strong>causal</strong></li>
<li>The path through $Z_3$ is <strong>closed</strong> since $Z_3$ is a <em>collider</em> and it is <strong>spurious</strong></li>
</ol>
<p>Let&rsquo;s draw the same graph indicating in <em>grey</em> variables that we are conditioning on, with <em>dotted lines</em> closed paths, with <em>red lines</em> spurious open paths, and with <em>green lines</em> causal open paths.</p>
<pre><code class="language-mermaid">flowchart LR
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;

X((X))
Y((Y))
Z1((Z1))
Z2((Z2))
Z3((Z3))

X --&gt; Y
X --&gt; Z2
Z2 --&gt; Y
Z1 --&gt; X
Z1 --&gt; Y
X -.-&gt; Z3
Y -.-&gt; Z3

linkStyle 0,1,2 stroke:#00ff00,stroke-width:4px;
linkStyle 3,4 stroke:#ff0000,stroke-width:4px;
class X,Y included;
class Z1,Z2,Z3 excluded;
</code></pre>
<p>In this case, to assess the <strong>causal</strong> relationship between $X$ and $Y$ we need to <strong>close</strong> the path that passes through $Z_1$. We can do that by conditioning the analysis on $Z_1$.</p>
<pre><code class="language-mermaid">flowchart LR
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;

X((X))
Y((Y))
Z1((Z1))
Z2((Z2))
Z3((Z3))

X --&gt; Y
X --&gt; Z2
Z2 --&gt; Y
Z1 -.-&gt; X
Z1 -.-&gt; Y
X -.-&gt; Z3
Y -.-&gt; Z3

linkStyle 0,1,2 stroke:#00ff00,stroke-width:4px;
class X,Y,Z1 included;
class Z2,Z3 excluded;
</code></pre>
<p>Now we are able to recover the causal relationship between $X$ and $Y$ by conditioning on $Z_1$.</p>
<p>What would happen if we were also <strong>conditioning on $Z_2$</strong>? In this case, we would <strong>close</strong> the path passing through $Z_2$ leaving only the <em>direct</em> path between $X$ and $Y$ open. We would then recover only the <strong>direct effect</strong> of $X$ on $Y$ and not the <em>indirect</em> one.</p>
<pre><code class="language-mermaid">flowchart LR
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;

X((X))
Y((Y))
Z1((Z1))
Z2((Z2))
Z3((Z3))

X --&gt; Y
X -.-&gt; Z2
Z2 -.-&gt; Y
Z1 -.-&gt; X
Z1 -.-&gt; Y
X -.-&gt; Z3
Y -.-&gt; Z3

linkStyle 0 stroke:#00ff00,stroke-width:4px;
class X,Y,Z1,Z2 included;
class Z3 excluded;
</code></pre>
<p>What would happen if we were also <strong>conditioning on $Z_3$</strong>? In this case, we would <strong>open</strong> the path passing through $Z_3$ which is a <strong>spurious</strong> path. We would then <strong>not</strong> be able to recover the causal effect of $X$ on $Y$.</p>
<pre><code class="language-mermaid">flowchart LR
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;

X((X))
Y((Y))
Z1((Z1))
Z2((Z2))
Z3((Z3))

X --&gt; Y
X -.-&gt; Z2
Z2 -.-&gt; Y
Z1 -.-&gt; X
Z1 -.-&gt; Y
X --&gt; Z3
Y --&gt; Z3

linkStyle 0 stroke:#00ff00,stroke-width:4px;
linkStyle 5,6 stroke:#ff0000,stroke-width:4px;
class X,Y,Z1,Z2,Z3 included;
</code></pre>
<h2 id="example-class-size-and-math-scores">Example: Class Size and Math Scores</h2>
<p>Suppose you are interested in the <strong>effect of class size on math scores</strong>. Are bigger classes better or worse for students&rsquo; performance?</p>
<p>Assume that the data generating process can be represented with the following <strong>DAG</strong>.</p>
<pre><code class="language-mermaid">flowchart TB
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;
classDef unobserved fill:#ffffff,stroke:#000000,stroke-width:2px,stroke-dasharray: 5 5;


X((class size))
Y((math score))
Z1((class year))
Z2((good school))
Z3((math hours))
Z4((hist score))
U((ability))

X --&gt; Y
Z1 --&gt; X
X --&gt; Z4
U --&gt; Y
U --&gt; Z4
Z2 --&gt; X
Z2 --&gt; Y
Z2 --&gt; Z4
Z3 --&gt; Y

class X,Y included;
class Z1,Z2,Z3,Z4 excluded;
class U unobserved;
</code></pre>
<p>The variables of interest are highlighted. Moreover, the dotted line around <code>ability</code> indicates that this is a variable that we do not observe in the data.</p>
<p>We can now load the data and check what it looks like.</p>
<pre><code class="language-python">%matplotlib inline
%config InlineBackend.figure_format = 'retina'
from src.utils import *
</code></pre>
<pre><code class="language-python">from src.dgp import dgp_school

df = dgp_school().generate_data()
df.head()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>math_hours</th>
      <th>history_hours</th>
      <th>good_school</th>
      <th>class_year</th>
      <th>class_size</th>
      <th>math_score</th>
      <th>hist_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>15</td>
      <td>13.009309</td>
      <td>15.167024</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>19</td>
      <td>13.047033</td>
      <td>13.387456</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>25</td>
      <td>8.330311</td>
      <td>10.824070</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>4</td>
      <td>1</td>
      <td>3</td>
      <td>22</td>
      <td>11.322190</td>
      <td>14.594394</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>4</td>
      <td>15</td>
      <td>12.338458</td>
      <td>11.871626</td>
    </tr>
  </tbody>
</table>
</div>
<p>What variables should we condition our regression on, in order to estimate the causal effect of <code>class size</code> on <code>math scores</code>?</p>
<p>First of all, let&rsquo;s look at what happens if we do not condition our analysis on any variable and we just regress <code>math score</code> on <code>class size</code>.</p>
<pre><code class="language-python">smf.ols('math_score ~ class_size', df).fit().summary().tables[1]
</code></pre>
<table class="simpletable">
<tr>
       <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>  <td>   12.0421</td> <td>    0.259</td> <td>   46.569</td> <td> 0.000</td> <td>   11.535</td> <td>   12.550</td>
</tr>
<tr>
  <th>class_size</th> <td>   -0.0399</td> <td>    0.013</td> <td>   -3.025</td> <td> 0.003</td> <td>   -0.066</td> <td>   -0.014</td>
</tr>
</table>
<p>The effect of <code>class_size</code> is negative and statistically different from zero.</p>
<p>But should we believe this estimated effect? Without controlling for anything, this is <strong>DAG representation</strong> of the effect we are capturing.</p>
<pre><code class="language-mermaid">flowchart TB
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;
classDef unobserved fill:#ffffff,stroke:#000000,stroke-width:2px,stroke-dasharray: 5 5;


X((class size))
Y((math score))
Z1((class year))
Z2((good school))
Z3((math hours))
Z4((hist score))
U((ability))

X --&gt; Y
Z1 --&gt; X
X -.-&gt; Z4
U --&gt; Y
U -.-&gt; Z4
Z2 --&gt; X
Z2 --&gt; Y
Z2 --&gt; Z4
Z3 --&gt; Y

linkStyle 0 stroke:#00ff00,stroke-width:4px;
linkStyle 5,6 stroke:#ff0000,stroke-width:4px;

class X,Y included;
class Z1,Z2,Z3,Z4 excluded;
class U unobserved;
</code></pre>
<p>There is a <strong>spurious</strong> path passing through <code>good school</code> that <strong>biases</strong> our estimated coefficient. Intuitively, being enrolled in a better school improves the students&rsquo; math scores and better schools might have smaller class sizes. We need to control for the quality of the school.</p>
<pre><code class="language-python">smf.ols('math_score ~ class_size + good_school', df).fit().summary().tables[1]
</code></pre>
<table class="simpletable">
<tr>
       <td></td>          <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>   <td>    4.7449</td> <td>    0.247</td> <td>   19.176</td> <td> 0.000</td> <td>    4.259</td> <td>    5.230</td>
</tr>
<tr>
  <th>class_size</th>  <td>    0.2095</td> <td>    0.010</td> <td>   20.020</td> <td> 0.000</td> <td>    0.189</td> <td>    0.230</td>
</tr>
<tr>
  <th>good_school</th> <td>    5.0807</td> <td>    0.130</td> <td>   39.111</td> <td> 0.000</td> <td>    4.826</td> <td>    5.336</td>
</tr>
</table>
<p>Now the estimate of the effect of <code>class size</code> on <code>math score</code> is <strong>unbiased</strong>! Indeed, the true coefficient in the data generating process was $0.2$.</p>
<pre><code class="language-mermaid">flowchart TB
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;
classDef unobserved fill:#ffffff,stroke:#000000,stroke-width:2px,stroke-dasharray: 5 5;


X((class size))
Y((math score))
Z1((class year))
Z2((good school))
Z3((math hours))
Z4((hist score))
U((ability))

X --&gt; Y
Z1 --&gt; X
X -.-&gt; Z4
U --&gt; Y
U -.-&gt; Z4
Z2 -.-&gt; X
Z2 -.-&gt; Y
Z2 --&gt; Z4
Z3 --&gt; Y

linkStyle 0 stroke:#00ff00,stroke-width:4px;

class X,Y,Z2 included;
class Z1,Z3,Z4 excluded;
class U unobserved;
</code></pre>
<p>What would happen if we were to instead <strong>control for all variables</strong>?</p>
<pre><code class="language-python">smf.ols('math_score ~ class_size + good_school + math_hours + class_year + hist_score', df).fit().summary().tables[1]
</code></pre>
<table class="simpletable">
<tr>
       <td></td>          <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>   <td>   -0.7847</td> <td>    0.310</td> <td>   -2.529</td> <td> 0.012</td> <td>   -1.394</td> <td>   -0.176</td>
</tr>
<tr>
  <th>class_size</th>  <td>    0.1292</td> <td>    0.010</td> <td>   13.054</td> <td> 0.000</td> <td>    0.110</td> <td>    0.149</td>
</tr>
<tr>
  <th>good_school</th> <td>    2.9815</td> <td>    0.170</td> <td>   17.533</td> <td> 0.000</td> <td>    2.648</td> <td>    3.315</td>
</tr>
<tr>
  <th>math_hours</th>  <td>    1.0516</td> <td>    0.048</td> <td>   21.744</td> <td> 0.000</td> <td>    0.957</td> <td>    1.147</td>
</tr>
<tr>
  <th>class_year</th>  <td>    0.0424</td> <td>    0.037</td> <td>    1.130</td> <td> 0.259</td> <td>   -0.031</td> <td>    0.116</td>
</tr>
<tr>
  <th>hist_score</th>  <td>    0.4116</td> <td>    0.027</td> <td>   15.419</td> <td> 0.000</td> <td>    0.359</td> <td>    0.464</td>
</tr>
</table>
<p>The coefficient is again <strong>biased</strong>. Why?</p>
<p>We have opened a new spurious path by controlling for <code>hist score</code>. In fact, <code>hist score</code> is a <strong>collider</strong> and controlling for it has opened a path through <code>hist score</code> and <code>ability</code> that was otherwise closed.</p>
<pre><code class="language-mermaid">flowchart TB
classDef included fill:#DCDCDC,stroke:#000000,stroke-width:2px;
classDef excluded fill:#ffffff,stroke:#000000,stroke-width:2px;
classDef unobserved fill:#ffffff,stroke:#000000,stroke-width:2px,stroke-dasharray: 5 5;


X((class size))
Y((math score))
Z1((class year))
Z2((good school))
Z3((math hours))
Z4((hist score))
U((ability))

X --&gt; Y
Z1 --&gt; X
X --&gt; Z4
U --&gt; Y
U --&gt; Z4
Z2 -.-&gt; X
Z2 -.-&gt; Y
Z2 --&gt; Z4
Z3 --&gt; Y

linkStyle 0 stroke:#00ff00,stroke-width:4px;
linkStyle 2,3,4 stroke:#ff0000,stroke-width:4px;

class X,Y,Z1,Z2,Z3,Z4 included;
class U unobserved;
</code></pre>
<p>The example was inspired by the following tweet.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">We can illustrate this with Model 16 of the &quot;Crash Course in Good and Bad Controls&quot; (<a href="https://t.co/GcSNzhuVt2">https://t.co/GcSNzhuVt2</a>). Here X = class size, Y = math4, Z = read4, and U = student&#39;s ability. Conditioning on Z opens the path X -&gt; Z &lt;- U -&gt; Y and it is thus a &quot;bad control.&quot; <a href="https://t.co/KNfqtsMWwB">https://t.co/KNfqtsMWwB</a> <a href="https://t.co/lUSigNYSJj">pic.twitter.com/lUSigNYSJj</a></p>&mdash; An√°lise Real (@analisereal) <a href="https://twitter.com/analisereal/status/1502793254592401409?ref_src=twsrc%5Etfw">March 12, 2022</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="conclusion">Conclusion</h2>
<p>In this post, we have seen how to use Directed Acyclic Graphs to select control variables in a causal analysis. DAGs are very helpful tools since they provide an intuitive graphical representation of causal relationships between random variables. Contrary to common intuition that &ldquo;the more information the better&rdquo;, sometimes including extra variables might bias the analysis, preventing a causal interpretation of the results. In particular, we must pay attention not to include <em>colliders</em> that open <em>spurious</em> paths that would otherwise be closed.</p>
<h2 id="references">References</h2>
<p>[1] C. Cinelli, A. Forney, J. Pearl, <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3689437" target="_blank" rel="noopener">A Crash Course in Good and Bad Controls</a> (2018), working paper.</p>
<p>[2] J. Pearl, <a href="http://bayes.cs.ucla.edu/BOOK-2K/" target="_blank" rel="noopener">Causality</a> (2009), Cambridge University Press.</p>
<p>[3] S. Cunningham, Chapter 3 of <a href="https://mixtape.scunning.com/dag.html" target="_blank" rel="noopener">The Causal Inference Mixtape</a> (2021), Yale University Press.</p>

          </div>
          


















  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://matteocourthoud.github.io/"><img class="avatar mr-3 avatar-circle" src="/author/avatar_hu365eedc833ccd5578a90de7c849ec45e_385094_270x270_fill_q75_lanczos_center.jpg" alt=""></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://matteocourthoud.github.io/"></a></h5>
      
      <p class="card-text">I hold a PhD in economics from the University of Zurich. Now I work at the intersection of economics, data science and statistics. I regularly write about causal inference on <a href="https://medium.com/@matteo.courthoud" target="_blank" rel="noopener">Medium</a>.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://medium.com/@matteo.courthoud" target="_blank" rel="noopener">
        <i class="fab fa-medium"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/matteo-courthoud-7335198a/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/MatteoCourthoud/" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/matteocourthoud" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://open.spotify.com/user/1180947523" target="_blank" rel="noopener">
        <i class="fab fa-spotify"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>
















  
  




        </div>
        </article>
    </main>
  </div>
</div>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  

  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms</a>
    
  </p>
  

  

  
  







</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.4/mermaid.min.js" integrity="sha512-as1BF4+iHZ3BVO6LLDQ7zrbvTXM+c/1iZ1qII/c3c4L8Rn5tHLpFUtpaEtBNS92f+xGsCzsD7b62XP3XYap6oA==" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/julia.min.js"></script>
        
      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.4ea9cc8d09c5c158656ac1a804743b34.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
