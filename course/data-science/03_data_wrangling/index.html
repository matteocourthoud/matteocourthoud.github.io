<!DOCTYPE html><html lang="en-us" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.1.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  

  
  
  
    
  
  <meta name="description" content="import numpy as np import pandas as pd  Setup For the scope of this tutorial we are going to use AirBnb Scraped data for the city of Bologna. The data is freely available at Inside AirBnb: http://insideairbnb." />

  
  <link rel="alternate" hreflang="en-us" href="https://matteocourthoud.github.io/course/data-science/03_data_wrangling/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#003f5c" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Source+Sans+Pro:wght@200;300;400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Source+Sans+Pro:wght@200;300;400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.431c3d640fb033a4e976f2978367bc3e.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144780600-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-144780600-1', { 'anonymize_ip': true });
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu03e9b3967b83fd39296ec9da5ff1ea05_201175_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu03e9b3967b83fd39296ec9da5ff1ea05_201175_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://matteocourthoud.github.io/course/data-science/03_data_wrangling/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="Matteo Courthoud" />
  <meta property="og:url" content="https://matteocourthoud.github.io/course/data-science/03_data_wrangling/" />
  <meta property="og:title" content="Data Wrangling | Matteo Courthoud" />
  <meta property="og:description" content="import numpy as np import pandas as pd  Setup For the scope of this tutorial we are going to use AirBnb Scraped data for the city of Bologna. The data is freely available at Inside AirBnb: http://insideairbnb." /><meta property="og:image" content="https://matteocourthoud.github.io/media/icon_hu03e9b3967b83fd39296ec9da5ff1ea05_201175_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="https://matteocourthoud.github.io/media/icon_hu03e9b3967b83fd39296ec9da5ff1ea05_201175_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2022-02-27T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2022-02-27T00:00:00&#43;00:00">
  

  



  

  
  
  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js" integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css" integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#003f5c",
          "text": "rgb(255, 255, 255)"
        },
        "button": {
          "background": "rgb(255, 255, 255)",
          "text": "#003f5c"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "/privacy/"
      }
    })});
  </script>


  





  <title>Data Wrangling | Matteo Courthoud</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="d0a2a1de52a8116414b7b06f1b27a775" >

  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.6edaf3b475ce43de30d98828aea698be.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Matteo Courthoud</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Matteo Courthoud</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Research</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Courses</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/course/ml-econ/"><span>Machine Learning for Economics</span></a>
            
              <a class="dropdown-item" href="/course/data-science/"><span>Data Science with Python</span></a>
            
              <a class="dropdown-item" href="/course/empirical-io/"><span>Graduate Industrial Organization</span></a>
            
              <a class="dropdown-item" href="/course/metrics/"><span>Graduate Econometrics</span></a>
            
              <a class="dropdown-item" href="https://pp4rs.github.io/"><span>Programming Practices for Research</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/post/"><span>Posts</span></a>
        </li>

        
        

        

        
        
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/cv"><span>CV</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      
<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li><a href="/course/"><i class="fas fa-arrow-left pr-1"></i>Courses</a></li>
      </ul>

      
      
        
          
        
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/course/data-science/">Data Science</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/course/data-science/01_data_exploration/">Data Exploration</a></li>



  <li class=""><a href="/course/data-science/02_data_types/">Data Types</a></li>



  <li class="active"><a href="/course/data-science/03_data_wrangling/">Data Wrangling</a></li>



  <li class=""><a href="/course/data-science/04_plotting/">Plotting</a></li>



  <li class=""><a href="/course/data-science/05_ml_pipeline/">Machine Learning Pipeline</a></li>



  <li class=""><a href="/course/data-science/06_web_scraping/">Web Scraping</a></li>

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      

      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#setup">Setup</a></li>
    <li><a href="#editing-the-dataframe">Editing the Dataframe</a></li>
    <li><a href="#aggregating">Aggregating</a></li>
    <li><a href="#reshaping">Reshaping</a></li>
    <li><a href="#combining-datasets">Combining Datasets</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">

          <h1>Data Wrangling</h1>

          <p>Last updated on Feb 27, 2022</p>

          <div class="article-style">
            <pre><code class="language-python">import numpy as np
import pandas as pd
</code></pre>
<h2 id="setup">Setup</h2>
<p>For the scope of this tutorial we are going to use AirBnb Scraped data for the city of Bologna. The data is freely available at <strong>Inside AirBnb</strong>: <a href="http://insideairbnb.com/get-the-data.html" target="_blank" rel="noopener">http://insideairbnb.com/get-the-data.html</a>.</p>
<p>A description of all variables in all datasets is avaliable <a href="https://docs.google.com/spreadsheets/d/1iWCNJcSutYqpULSQHlNyGInUvHg2BoUGoNRIGa6Szc4/edit#gid=982310896" target="_blank" rel="noopener">here</a>.</p>
<p>We are going to use 2 datasets:</p>
<ul>
<li>listing dataset: contains listing-level information</li>
<li>pricing dataset: contains pricing data, over time</li>
</ul>
<pre><code class="language-python"># Import listings data
url_listings = &quot;http://data.insideairbnb.com/italy/emilia-romagna/bologna/2021-12-17/visualisations/listings.csv&quot;
df_listings = pd.read_csv(url_listings)

# Import pricing data
url_prices = &quot;http://data.insideairbnb.com/italy/emilia-romagna/bologna/2021-12-17/data/calendar.csv.gz&quot;
df_prices = pd.read_csv(url_prices, compression=&quot;gzip&quot;)
</code></pre>
<h2 id="editing-the-dataframe">Editing the Dataframe</h2>
<p>You can <strong>sort</strong> the data using the <code>sort_values</code> function.</p>
<p><em>Options</em></p>
<ul>
<li><code>ascending</code>: bool or list of bool, default True</li>
<li><code>na_position</code>: {‘first’, ‘last’}, default ‘last’</li>
</ul>
<pre><code class="language-python">df_listings.sort_values(by=['name', 'price'], 
                        ascending=[False, True], 
                        na_position='last').head()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>host_id</th>
      <th>host_name</th>
      <th>neighbourhood_group</th>
      <th>neighbourhood</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>room_type</th>
      <th>price</th>
      <th>minimum_nights</th>
      <th>number_of_reviews</th>
      <th>last_review</th>
      <th>reviews_per_month</th>
      <th>calculated_host_listings_count</th>
      <th>availability_365</th>
      <th>number_of_reviews_ltm</th>
      <th>license</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2280</th>
      <td>38601411</td>
      <td>🏡Giardino di Annabella-relax in città-casa intera</td>
      <td>240803020</td>
      <td>Annabella</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.49303</td>
      <td>11.31986</td>
      <td>Entire home/apt</td>
      <td>90</td>
      <td>2</td>
      <td>53</td>
      <td>2021-12-13</td>
      <td>1.96</td>
      <td>1</td>
      <td>76</td>
      <td>27</td>
      <td>392901</td>
    </tr>
    <tr>
      <th>2988</th>
      <td>48177313</td>
      <td>❤ Romantic Suite with SPA Bath ❤ 4starbologna.com</td>
      <td>239491712</td>
      <td>4 Star Bologna</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.50271</td>
      <td>11.34998</td>
      <td>Entire home/apt</td>
      <td>309</td>
      <td>1</td>
      <td>1</td>
      <td>2021-03-14</td>
      <td>0.11</td>
      <td>14</td>
      <td>344</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3302</th>
      <td>52367336</td>
      <td>✨House of Alchemy✨</td>
      <td>140013413</td>
      <td>Greta</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.49072</td>
      <td>11.30890</td>
      <td>Entire home/apt</td>
      <td>96</td>
      <td>2</td>
      <td>7</td>
      <td>2021-11-28</td>
      <td>3.18</td>
      <td>1</td>
      <td>88</td>
      <td>7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2039</th>
      <td>34495335</td>
      <td>♥ Romantic for Couple in Love ♥ | 4 Star Boutique</td>
      <td>239491712</td>
      <td>4 Star Bologna</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.50368</td>
      <td>11.34972</td>
      <td>Entire home/apt</td>
      <td>143</td>
      <td>1</td>
      <td>25</td>
      <td>2021-08-20</td>
      <td>0.79</td>
      <td>14</td>
      <td>262</td>
      <td>6</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2964</th>
      <td>47866124</td>
      <td>♡Amazing Suite with Private SPA ♡ 4starbologna...</td>
      <td>239491712</td>
      <td>4 Star Bologna</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.50381</td>
      <td>11.34951</td>
      <td>Entire home/apt</td>
      <td>347</td>
      <td>1</td>
      <td>2</td>
      <td>2021-10-17</td>
      <td>0.72</td>
      <td>14</td>
      <td>337</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
<p>You can remane columns using the <code>rename()</code> function. It takes a dictionary as <code>column</code> argument in the form <code>{&quot;old_name&quot;: &quot;new_name&quot;}</code>.</p>
<pre><code class="language-python">df_listings.rename(columns={'name': 'listing_name', 
                            'id': 'listing_id'}).head()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>listing_id</th>
      <th>listing_name</th>
      <th>host_id</th>
      <th>host_name</th>
      <th>neighbourhood_group</th>
      <th>neighbourhood</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>room_type</th>
      <th>price</th>
      <th>minimum_nights</th>
      <th>number_of_reviews</th>
      <th>last_review</th>
      <th>reviews_per_month</th>
      <th>calculated_host_listings_count</th>
      <th>availability_365</th>
      <th>number_of_reviews_ltm</th>
      <th>license</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>42196</td>
      <td>50 sm Studio in the historic centre</td>
      <td>184487</td>
      <td>Carlo</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.48507</td>
      <td>11.34786</td>
      <td>Entire home/apt</td>
      <td>68</td>
      <td>3</td>
      <td>180</td>
      <td>2021-11-12</td>
      <td>1.32</td>
      <td>1</td>
      <td>161</td>
      <td>6</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>46352</td>
      <td>A room in Pasolini's house</td>
      <td>467810</td>
      <td>Eleonora</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.49168</td>
      <td>11.33514</td>
      <td>Private room</td>
      <td>29</td>
      <td>1</td>
      <td>300</td>
      <td>2021-11-30</td>
      <td>2.20</td>
      <td>2</td>
      <td>248</td>
      <td>37</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>59697</td>
      <td>COZY LARGE BEDROOM in the city center</td>
      <td>286688</td>
      <td>Paolo</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.48817</td>
      <td>11.34124</td>
      <td>Private room</td>
      <td>50</td>
      <td>1</td>
      <td>240</td>
      <td>2020-10-04</td>
      <td>2.18</td>
      <td>2</td>
      <td>327</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>85368</td>
      <td>Garden House Bologna</td>
      <td>467675</td>
      <td>Anna Maria</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.47834</td>
      <td>11.35672</td>
      <td>Entire home/apt</td>
      <td>126</td>
      <td>2</td>
      <td>40</td>
      <td>2019-11-03</td>
      <td>0.34</td>
      <td>1</td>
      <td>332</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>145779</td>
      <td>SINGLE ROOM</td>
      <td>705535</td>
      <td>Valerio</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.49306</td>
      <td>11.33786</td>
      <td>Private room</td>
      <td>50</td>
      <td>10</td>
      <td>69</td>
      <td>2021-12-05</td>
      <td>0.55</td>
      <td>9</td>
      <td>365</td>
      <td>5</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
<h2 id="aggregating">Aggregating</h2>
<p>We can compute statistics by group using <code>groupby()</code>.</p>
<pre><code class="language-python">df_listings.groupby('neighbourhood')[['price', 'reviews_per_month']].mean()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>reviews_per_month</th>
    </tr>
    <tr>
      <th>neighbourhood</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Borgo Panigale - Reno</th>
      <td>83.020548</td>
      <td>0.983488</td>
    </tr>
    <tr>
      <th>Navile</th>
      <td>142.200993</td>
      <td>1.156745</td>
    </tr>
    <tr>
      <th>Porto - Saragozza</th>
      <td>129.908312</td>
      <td>1.340325</td>
    </tr>
    <tr>
      <th>San Donato - San Vitale</th>
      <td>91.618138</td>
      <td>0.933011</td>
    </tr>
    <tr>
      <th>Santo Stefano</th>
      <td>119.441841</td>
      <td>1.344810</td>
    </tr>
    <tr>
      <th>Savena</th>
      <td>69.626016</td>
      <td>0.805888</td>
    </tr>
  </tbody>
</table>
</div>
<p>If you want to perform more than one function, maybe on different columns, you can use <code>aggregate()</code> which can be shortened to <code>agg()</code>. The sintax is <code>agg(output_var = (&quot;input_var&quot;, function))</code> and it accepts also <code>numpy</code> functions.</p>
<pre><code class="language-python">df_listings.groupby('neighbourhood').agg(mean_reviews=(&quot;reviews_per_month&quot;, &quot;mean&quot;),
                                         min_price=(&quot;price&quot;, &quot;min&quot;),
                                         max_price=(&quot;price&quot;, np.max)).reset_index()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>neighbourhood</th>
      <th>mean_reviews</th>
      <th>min_price</th>
      <th>max_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Borgo Panigale - Reno</td>
      <td>0.983488</td>
      <td>9</td>
      <td>1429</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Navile</td>
      <td>1.156745</td>
      <td>14</td>
      <td>5000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Porto - Saragozza</td>
      <td>1.340325</td>
      <td>7</td>
      <td>9999</td>
    </tr>
    <tr>
      <th>3</th>
      <td>San Donato - San Vitale</td>
      <td>0.933011</td>
      <td>10</td>
      <td>1600</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Santo Stefano</td>
      <td>1.344810</td>
      <td>11</td>
      <td>9999</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Savena</td>
      <td>0.805888</td>
      <td>9</td>
      <td>680</td>
    </tr>
  </tbody>
</table>
</div>
<p>If we want to build a new column by group, we can use <code>transform()</code> on the grouped data. Unfortunately, it does not work as nicely as <code>aggregate()</code> and we have to do one column at the time.</p>
<pre><code class="language-python">df_listings.groupby('neighbourhood')[['price', 'reviews_per_month']].transform('mean')
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>reviews_per_month</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>119.441841</td>
      <td>1.344810</td>
    </tr>
    <tr>
      <th>1</th>
      <td>129.908312</td>
      <td>1.340325</td>
    </tr>
    <tr>
      <th>2</th>
      <td>119.441841</td>
      <td>1.344810</td>
    </tr>
    <tr>
      <th>3</th>
      <td>119.441841</td>
      <td>1.344810</td>
    </tr>
    <tr>
      <th>4</th>
      <td>129.908312</td>
      <td>1.340325</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3448</th>
      <td>142.200993</td>
      <td>1.156745</td>
    </tr>
    <tr>
      <th>3449</th>
      <td>129.908312</td>
      <td>1.340325</td>
    </tr>
    <tr>
      <th>3450</th>
      <td>142.200993</td>
      <td>1.156745</td>
    </tr>
    <tr>
      <th>3451</th>
      <td>119.441841</td>
      <td>1.344810</td>
    </tr>
    <tr>
      <th>3452</th>
      <td>129.908312</td>
      <td>1.340325</td>
    </tr>
  </tbody>
</table>
<p>3453 rows × 2 columns</p>
</div>
<h2 id="reshaping">Reshaping</h2>
<pre><code class="language-python">
</code></pre>
<h2 id="combining-datasets">Combining Datasets</h2>
<p>We can <strong>concatenate</strong> datasets using <code>pd.concat()</code>. It takes as argument a list of dataframes. By default, <code>pd.concat()</code> performs the outer join. We can change it using the <code>join</code> option.</p>
<pre><code class="language-python">df_listings1 = df_listings[:2000]
np.shape(df_listings1)
</code></pre>
<pre><code>(2000, 18)
</code></pre>
<pre><code class="language-python">df_listings2 = df_listings[1000:]
np.shape(df_listings2)
</code></pre>
<pre><code>(2453, 18)
</code></pre>
<pre><code class="language-python">np.shape(
    pd.concat([df_listings1, df_listings2], join='inner')
)
</code></pre>
<pre><code>(4453, 18)
</code></pre>
<p>To instead merge dataframes, we can use the <code>pd.merge</code> function.</p>
<p><em>Options</em></p>
<ul>
<li><code>how</code>: {‘left’, ‘right’, ‘outer’, ‘inner’, ‘cross’}, default ‘inner’</li>
<li><code>on</code>: label or list</li>
</ul>
<pre><code class="language-python">pd.merge(df_listings, df_prices, left_on='id', right_on='listing_id', how='inner')
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>host_id</th>
      <th>host_name</th>
      <th>neighbourhood_group</th>
      <th>neighbourhood</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>room_type</th>
      <th>price_x</th>
      <th>...</th>
      <th>availability_365</th>
      <th>number_of_reviews_ltm</th>
      <th>license</th>
      <th>listing_id</th>
      <th>date</th>
      <th>available</th>
      <th>price_y</th>
      <th>adjusted_price</th>
      <th>minimum_nights_y</th>
      <th>maximum_nights</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>42196</td>
      <td>50 sm Studio in the historic centre</td>
      <td>184487</td>
      <td>Carlo</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.485070</td>
      <td>11.347860</td>
      <td>Entire home/apt</td>
      <td>68</td>
      <td>...</td>
      <td>161</td>
      <td>6</td>
      <td>NaN</td>
      <td>42196</td>
      <td>2021-12-17</td>
      <td>f</td>
      <td>$68.00</td>
      <td>$68.00</td>
      <td>3</td>
      <td>360</td>
    </tr>
    <tr>
      <th>1</th>
      <td>42196</td>
      <td>50 sm Studio in the historic centre</td>
      <td>184487</td>
      <td>Carlo</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.485070</td>
      <td>11.347860</td>
      <td>Entire home/apt</td>
      <td>68</td>
      <td>...</td>
      <td>161</td>
      <td>6</td>
      <td>NaN</td>
      <td>42196</td>
      <td>2021-12-18</td>
      <td>f</td>
      <td>$68.00</td>
      <td>$68.00</td>
      <td>3</td>
      <td>360</td>
    </tr>
    <tr>
      <th>2</th>
      <td>42196</td>
      <td>50 sm Studio in the historic centre</td>
      <td>184487</td>
      <td>Carlo</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.485070</td>
      <td>11.347860</td>
      <td>Entire home/apt</td>
      <td>68</td>
      <td>...</td>
      <td>161</td>
      <td>6</td>
      <td>NaN</td>
      <td>42196</td>
      <td>2021-12-19</td>
      <td>f</td>
      <td>$68.00</td>
      <td>$68.00</td>
      <td>3</td>
      <td>360</td>
    </tr>
    <tr>
      <th>3</th>
      <td>42196</td>
      <td>50 sm Studio in the historic centre</td>
      <td>184487</td>
      <td>Carlo</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.485070</td>
      <td>11.347860</td>
      <td>Entire home/apt</td>
      <td>68</td>
      <td>...</td>
      <td>161</td>
      <td>6</td>
      <td>NaN</td>
      <td>42196</td>
      <td>2021-12-20</td>
      <td>f</td>
      <td>$68.00</td>
      <td>$68.00</td>
      <td>3</td>
      <td>360</td>
    </tr>
    <tr>
      <th>4</th>
      <td>42196</td>
      <td>50 sm Studio in the historic centre</td>
      <td>184487</td>
      <td>Carlo</td>
      <td>NaN</td>
      <td>Santo Stefano</td>
      <td>44.485070</td>
      <td>11.347860</td>
      <td>Entire home/apt</td>
      <td>68</td>
      <td>...</td>
      <td>161</td>
      <td>6</td>
      <td>NaN</td>
      <td>42196</td>
      <td>2021-12-21</td>
      <td>f</td>
      <td>$68.00</td>
      <td>$68.00</td>
      <td>3</td>
      <td>360</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1260340</th>
      <td>53854962</td>
      <td>A pochi passi dal Mercato delle Erbe by Wonder...</td>
      <td>13036400</td>
      <td>Wonderful Italy</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.497456</td>
      <td>11.337492</td>
      <td>Entire home/apt</td>
      <td>115</td>
      <td>...</td>
      <td>98</td>
      <td>0</td>
      <td>NaN</td>
      <td>53854962</td>
      <td>2022-12-12</td>
      <td>f</td>
      <td>$115.00</td>
      <td>$115.00</td>
      <td>1</td>
      <td>1125</td>
    </tr>
    <tr>
      <th>1260341</th>
      <td>53854962</td>
      <td>A pochi passi dal Mercato delle Erbe by Wonder...</td>
      <td>13036400</td>
      <td>Wonderful Italy</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.497456</td>
      <td>11.337492</td>
      <td>Entire home/apt</td>
      <td>115</td>
      <td>...</td>
      <td>98</td>
      <td>0</td>
      <td>NaN</td>
      <td>53854962</td>
      <td>2022-12-13</td>
      <td>f</td>
      <td>$115.00</td>
      <td>$115.00</td>
      <td>1</td>
      <td>1125</td>
    </tr>
    <tr>
      <th>1260342</th>
      <td>53854962</td>
      <td>A pochi passi dal Mercato delle Erbe by Wonder...</td>
      <td>13036400</td>
      <td>Wonderful Italy</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.497456</td>
      <td>11.337492</td>
      <td>Entire home/apt</td>
      <td>115</td>
      <td>...</td>
      <td>98</td>
      <td>0</td>
      <td>NaN</td>
      <td>53854962</td>
      <td>2022-12-14</td>
      <td>f</td>
      <td>$115.00</td>
      <td>$115.00</td>
      <td>1</td>
      <td>1125</td>
    </tr>
    <tr>
      <th>1260343</th>
      <td>53854962</td>
      <td>A pochi passi dal Mercato delle Erbe by Wonder...</td>
      <td>13036400</td>
      <td>Wonderful Italy</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.497456</td>
      <td>11.337492</td>
      <td>Entire home/apt</td>
      <td>115</td>
      <td>...</td>
      <td>98</td>
      <td>0</td>
      <td>NaN</td>
      <td>53854962</td>
      <td>2022-12-15</td>
      <td>f</td>
      <td>$115.00</td>
      <td>$115.00</td>
      <td>1</td>
      <td>1125</td>
    </tr>
    <tr>
      <th>1260344</th>
      <td>53854962</td>
      <td>A pochi passi dal Mercato delle Erbe by Wonder...</td>
      <td>13036400</td>
      <td>Wonderful Italy</td>
      <td>NaN</td>
      <td>Porto - Saragozza</td>
      <td>44.497456</td>
      <td>11.337492</td>
      <td>Entire home/apt</td>
      <td>115</td>
      <td>...</td>
      <td>98</td>
      <td>0</td>
      <td>NaN</td>
      <td>53854962</td>
      <td>2022-12-16</td>
      <td>f</td>
      <td>$115.00</td>
      <td>$115.00</td>
      <td>1</td>
      <td>1125</td>
    </tr>
  </tbody>
</table>
<p>1260345 rows × 25 columns</p>
</div>
<p>As you can see, since the variable <code>price</code> was present in both datasets, we now have a <code>price.x</code> and a <code>price.y</code>.</p>

          </div>

          



          
          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/course/data-science/02_data_types/" rel="next">Data Types</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/course/data-science/04_plotting/" rel="prev">Plotting</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">

          





          




          


  
  



        </div>

      </article>

      <footer class="site-footer">

  

  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms</a>
    
  </p>
  

  
  <p class="powered-by">
    Theme edited by Matteo Courthoud© - Want to have a similar website? <a href="https://matteocourthoud.github.io/post/website/">Guide here</a>.
  </p>
  

  
  







</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/julia.min.js"></script>
        
      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.cf8ca859a9b74f8b1cd804621b13e5f1.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
